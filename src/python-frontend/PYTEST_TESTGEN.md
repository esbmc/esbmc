# Python Pytest Test Case Generation

## Overview

ESBMC now supports automatic generation of pytest test cases for Python programs. This feature automatically discover test inputs that achieve high code coverage.

## Usage

### Basic Command

```bash
esbmc example.py --branch-coverage --generate-pytest-testcase
```

This will generate a `test_example.py` file containing pytest test cases.

### Input Format

Your Python code should use `__VERIFIER_nondet_*()` functions to mark symbolic inputs:

```python
# example.py
def classify_number(n: int) -> str:
    """Classify a number and return appropriate message"""
    if n > 0:
        if n > 100:
            return "large positive"
        else:
            return "small positive"
    elif n < 0:
        if n < -100:
            return "large negative"
        else:
            return "small negative"
    else:
        return "zero"

# Test generation mode: use nondet inputs
result = classify_number(__VERIFIER_nondet_int())

```

### Output Format

ESBMC will generate a pytest file like this:

```python
# Auto-generated by ESBMC 7.11.0
# Original file: example.py

from test import *
import pytest

@pytest.mark.parametrize("n", [
    -49,
    -4611686027017322505,
    0,
    -9223372036854775808,
    36,
    4611686018427388061,
    -9223372036854775805,
    2047,
])
def test_classify_number(n):
    """Auto-generated test cases for classify_number"""
    classify_number(n)

```

### Running the Tests
After the verification tool has generated the pytest test cases, you should remove the nondeterministic input lines
from the original program, such as `check_sign(__VERIFIER_nondet_int())`. These calls are required only during the
verification phase and are no longer needed (cause errors) when running the generated pytest tests.

```bash
# Run the generated tests
pytest test_example.py

# Run with coverage
pytest --cov=example --cov-branch
```

## Supported Types

- `__VERIFIER_nondet_int()` → Python int
- `__VERIFIER_nondet_bool()` → Python True/False
- `__VERIFIER_nondet_float()` → Python float

## Example: Multiple Parameters

```python
# example.py
def add_positive(a: int, b: int) -> int:
    """Add two positive numbers"""
    if a < 0 or b < 0:
        a = a + b
    return a + b

add_positive(__VERIFIER_nondet_int(), __VERIFIER_nondet_int())
```

Generated output:

```python
# Auto-generated by ESBMC 7.11.0
# Original file: example.py

from test import *
import pytest

@pytest.mark.parametrize("a,b", [
    (-9223372036854775808, -9223372036854775808),
    (0, 0),
    (-9223372036854775808, -9223372036854775808),
])
def test_add_positive(a,b):
    """Auto-generated test cases for add_positive"""
    add_positive(a, b)


```

## Comparison with C Test Generation

This feature is similar to the existing `--generate-testcase` flag for C programs, but outputs pytest-compatible Python test files instead of XML.

| Feature | C (`--generate-testcase`) | Python (`--generate-pytest-testcase`) |
|---------|---------------------------|---------------------------------------|
| Input Format | `int a = __VERIFIER_nondet_int();` | `__VERIFIER_nondet_int()` |
| Output Format | XML (Test-Comp format) | Python (pytest format) |
| Test Execution | Test-Comp tools | pytest |
| Coverage Measurement | Test-Comp | pytest-cov |