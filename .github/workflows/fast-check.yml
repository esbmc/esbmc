name: ESBMC Fast Health Checks

on: [push, pull_request]
jobs:

  # Check project with clang-format
  static-analysis:  
    runs-on: ubuntu-latest
    steps:      
    - uses: actions/checkout@v1    
    - name: Download Clang 7
      run: wget http://releases.llvm.org/7.0.1/clang+llvm-7.0.1-x86_64-linux-gnu-ubuntu-18.04.tar.xz
    - name: Extract Clang 7
      run: tar xf clang+llvm-7.0.1-x86_64-linux-gnu-ubuntu-18.04.tar.xz && mv clang+llvm-7.0.1-x86_64-linux-gnu-ubuntu-18.04 clang7
    - name: Run clang-format
      run: ./clang7/bin/clang-format -i -style=file ./src/*/*.h && ./clang7/bin/clang-format -i -style=file ./src/*/*.cpp
    - name: Throws error if changes were made
      continue-on-error: true
      run: git diff --exit-code